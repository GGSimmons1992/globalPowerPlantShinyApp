---
title: "R Notebook"
output: html_notebook
---
data load
```{r}
library(dplyr)
library(data.table)
library(ggplot2)
library(leaflet)
library(reshape2)
powerplants=read.csv('global_power_plant_database.csv')

powerplantsWithYearData = powerplants %>% group_by(country_long) %>% summarise(proportionWithData = 1 - mean(is.na(commissioning_year))) %>% filter(proportionWithData > .8)

powerplants = powerplants %>% filter(country_long %in% powerplantsWithYearData$country_long)

powerplants[is.na(powerplants)] = 0
powerplantsUSA = powerplants %>% filter(country_long == "United States of America")
```
Data prep
```{r}
powerplantsUSAFuel = powerplantsUSA %>% group_by(primary_fuel) 

powerplantsUSAFuelYear = powerplantsUSAFuel %>% summarise(energy2013 = 0.5* (sum(generation_gwh_2013) + sum(estimated_generation_gwh_2013)),
          energy2014 = 0.5* (sum(generation_gwh_2014) + sum(estimated_generation_gwh_2014)),
          energy2015 = 0.5* (sum(generation_gwh_2015) + sum(estimated_generation_gwh_2015)),
          energy2016 = 0.5* (sum(generation_gwh_2016) + sum(estimated_generation_gwh_2016)),
          energy2017 = 0.5* (sum(generation_gwh_2017) + sum(estimated_generation_gwh_2017)),
          )

powerplantsUSAFuelYearDF = as.data.frame(powerplantsUSAFuelYear)
powerplantsUSAFuelYearLabeled = powerplantsUSAFuelYearDF[,-1]
row.names(powerplantsUSAFuelYearLabeled) = powerplantsUSAFuelYearDF[,1]
transposePowerplantsUSAFuelYear = transpose(powerplantsUSAFuelYearLabeled)
colnames(transposePowerplantsUSAFuelYear) = powerplantsUSAFuelYearDF[,1]
transposePowerplantsUSAFuelYear$Year = c(2013,2014,2015,2016,2017)


totalEnergy = powerplantsUSAFuelYear %>% mutate(total = energy2013+ energy2014 +energy2015 + energy2016 + energy2017)

```

map
```{r}
leaflet(powerplantsUSA %>% filter(primary_fuel == "Wind")) %>% addTiles() %>% addMarkers(~longitude,~latitude,popup= ~primary_fuel,label= ~primary_fuel)
```

pie chart
```{r}
ggplot(totalEnergy,aes(x="",y=total,fill=primary_fuel)) + geom_bar(width=1,stat="identity") + coord_polar("y",start=0)
```

energy produced
```{r}

data_long = melt(transposePowerplantsUSAFuelYear, id="Year")
colnames(data_long) = c("Year","primary_fuel","energy")

lineplot = ggplot(data_long, aes(x=Year,y=energy, color= primary_fuel)) + ylab("Energy Produce MWH") + xlab("Year") + geom_line()

lineplot
```

number of plants by type
```{r}
numberOfPlants = powerplantsUSAFuel %>% summarize(number = n())
ggplot(numberOfPlants,aes(x=primary_fuel, y=number,fill=primary_fuel)) + geom_bar(stat="identity") + theme(axis.text.x = element_text(angle=90))
```

```{r}

```